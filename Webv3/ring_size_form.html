<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Share Your Ring Size</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; min-height: 100vh; display: flex; align-items: center; justify-content: center; background: #fff8f8; }
        main { background: #ffffff; border-radius: 12px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08); padding: 32px; max-width: 360px; width: 100%; text-align: center; }
        h1 { font-size: 1.5rem; margin-bottom: 1.5rem; color: #d6336c; }
        form { display: grid; gap: 1rem; }
        input[type="text"] { padding: 0.75rem 1rem; border: 1px solid #e0b8c4; border-radius: 8px; font-size: 1rem; }
        button { padding: 0.75rem 1rem; background: #d6336c; color: #fff; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: background 0.2s ease-in-out; }
        button:hover { background: #bf2b5d; }
        button:disabled { background: #f3b6c8; cursor: not-allowed; }
        #status { font-size: 0.95rem; min-height: 1.2em; }
    </style>
</head>
<body>
    <main>
        <h1>Tell Me Your Ring Size</h1>
        <form id="ring-form" autocomplete="off">
            <label for="ring-size" style="display:none;">Ring size</label>
            <input id="ring-size" name="ring-size" type="text" placeholder="e.g. 6 1/2 or 52 mm" required>
            <button type="submit">Send</button>
        </form>
        <p id="status" role="status" aria-live="polite"></p>
    </main>

    <script type="module">
        import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

        const SUPABASE_URL = "https://jhsqmtmehvwwvnkfjtxm.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impoc3FtdG1laHZ3d3Zua2ZqdHhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyMDA1OTAsImV4cCI6MjA3NDc3NjU5MH0.GZ1Vq4Xo2AJ1ONXViTVaD4FzlMBIfPTiJQz0m1TRsAI";

        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);
        const form = document.getElementById("ring-form");
        const statusEl = document.getElementById("status");
        const submitButton = form.querySelector("button");

        form.addEventListener("submit", async (event) => {
            event.preventDefault();
            statusEl.textContent = "";

            const ringSize = form.elements["ring-size"].value.trim();
            if (!ringSize) {
                statusEl.textContent = "Please enter a ring size.";
                return;
            }

            submitButton.disabled = true;

            try {
                const { error } = await supabase
                    .from("ring")
                    .update({ ring_size: ringSize })
                    .eq("id", 1);

                if (error) {
                    throw error;
                }

                statusEl.textContent = "💍 Saved! Thank you ❤️";
                form.reset();
            } catch (err) {
                console.error(err);
                statusEl.textContent = "❌ Something went wrong.";
            } finally {
                submitButton.disabled = false;
            }
        });
    </script>
</body>
</html>
